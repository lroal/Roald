// Copyright 2002 - 2007 Peter L. Blum, All Rights Reserved, www.PeterBlum.com
// Peter's Date Package Release 2.0.4

function CSC_FillInMonth(pCalCId,pDrawDateLabel){if(!gPDP_SupportsInnerHTML)return;var vCal=PDP_GetById(pCalCId);var vAO=vCal.AO;CSC_InitSize(vCal);CSC_FillInWeekRows(pCalCId,vAO);CSC_FillInMonthHeader(pCalCId);if(pDrawDateLabel)CSC_DrawDateLabel(vCal);CSC_UpdateCmdArrows(pCalCId,vAO);vAO.MonthLoaded=true;}function CSC_FillInWeekRows(pCalCId,pAO){function MVHeader(pMVId,pMV,pY,pM){var vL=PDP_GetById(pMVId+"_MMVL");if(vL){var vT="";switch(pAO.MVTF){case 2:case 3:vT=PDP_AbbrevMonths[pM];break;case 1:case 4:vT=PDP_Months[pM];break;default:break;}switch(pAO.MVTF){case 3:case 4:if(pAO.ShowYear=="leftofmonth")vT=pY+" "+vT;else vT=vT+" "+pY;break;default:break;}vL.innerHTML=vT;}}var vFst=pAO.InitFIWR==null;pAO.InitFIWR=1;if(pAO.MSC&&window.MSC_ClearHilite){if(pAO.DayCells)for(var vI=0;vI<pAO.DayCells.length;vI++)pAO.DayCells[vI]=null;pAO.DayCells=new Array;MSC_ClearHilite(pAO);}var vCHS=pAO.WRTbls[0].cellSpacing!="0";var vWEDay1=0;var vWEDay2=6;var vFDOW=pAO.FDOW;if(vFDOW!=0){vWEDay1=7-vFDOW;vWEDay2=6-vFDOW;}var vDCBrdC=pAO.DCBrdC;var vDCBrdSd=pAO.DCBrdSd;var vSDO=(window.SD_FindById)?SD_FindById(pAO.SDId):null;pAO.SDO=vSDO;var vMonth=pAO.Month;var vYear=pAO.Year;var vDay=1;var vTodayDate=PDP_MakeUTCDate(pAO.TodayY,pAO.TodayM,pAO.TodayD);var vTodayUTC=vTodayDate.valueOf();var vSpUTC=-1;var vSpDate=PDP_MakeUTCDate(pAO.SpecialY,pAO.SpecialM,pAO.SpecialD);if(vSpDate!=null)vSpUTC=vSpDate.valueOf();var vMinUTC=-1;var vMinDate=PDP_MakeUTCDate(pAO.MinY,pAO.MinM,pAO.MinD);if(vMinDate!=null)vMinUTC=vMinDate.valueOf();var vHasMin=vMinUTC!=-1;var vMaxUTC=-1;var vMaxDate=PDP_MakeUTCDate(pAO.MaxY,pAO.MaxM,pAO.MaxD);if(vMaxDate!=null)vMaxUTC=vMaxDate.valueOf();var vHasMax=vMaxUTC!=-1;var vThisMonth=vMonth;var vThisYear=vYear;pAO.ClearClSl(pAO);for(var vMV=0;vMV<pAO.MV;vMV++){var vMCId=CSC_MVCalId(pCalCId,vMV);if(pAO.MVTF)MVHeader(vMCId,vMV,vThisYear,vThisMonth);var vMonthPos=0;var vDateOfCell=PDP_MakeUTCDate(vYear,vMonth,vDay);var vCurUTC=vDateOfCell.valueOf();var vDayOfWeek=vDateOfCell.getUTCDay();if(vDayOfWeek!=vFDOW){if(vFDOW>vDayOfWeek)vCurUTC=vCurUTC-((vDayOfWeek-vFDOW+7)*86400000);else vCurUTC=vCurUTC-((vDayOfWeek-vFDOW)*86400000);vDateOfCell=new Date(vCurUTC);vMonth=vDateOfCell.getUTCMonth();vYear=vDateOfCell.getUTCFullYear();vDay=vDateOfCell.getUTCDate();vMonthPos=vThisMonth-1;}else vMonthPos=vThisMonth;var vBSD=null;if(vSDO){SD_InitSequentialSearch(vSDO);if(window.SD_InitTimeRowSearch)SD_InitTimeRowSearch(vSDO);}var vNVisR=0;var vOVisR=0;var vHiddenWeek=false;var vLastHadBorder=new Array(true,true,true,true,true,true,true);var vCurWkNum=1;var vLastWkNum=100;if(pAO.WkNm){var vWkNmRl=pAO.WkNmRl;vCurWkNum=PDP_GetWeekNum(vDateOfCell,vWkNmRl,vFDOW);if(vCurWkNum>44){var vDate2=PDP_GetFirstWeekNumDate(vDateOfCell.getUTCFullYear()+1,vWkNmRl,vFDOW);vLastWkNum=PDP_GetWeekNum(new Date(vDate2-(86400000*7)),vWkNmRl,vFDOW);}}var vDCIdCnt=1;for(vRowCount=0;vRowCount<6;vRowCount++){var vWR=CSC_GetWkRow(pAO,vMV,vRowCount);if(vWR.style.display!="none")vOVisR++;vWR.style.display="";if(vMonthPos<=vThisMonth)vNVisR++;else if(!pAO.OMWks){vWR.style.display="none";vHiddenWeek=true;}if(pAO.WkNm){PDP_SetInnerHTML(PDP_GetById(vMCId+"_WN"+vRowCount),vCurWkNum);vCurWkNum++;if(vCurWkNum>vLastWkNum)vCurWkNum=1;}for(vDayCount=0;vDayCount<7;vDayCount++){var vDC=CSC_GetDayCell(pAO,vWR,vDayCount,vMCId,vDCIdCnt);if(!vDC)break;if(pAO.DayCells)if((pAO.MV==1)||(vMonthPos==vThisMonth))pAO.DayCells[pAO.DayCells.length]=vDC;var vDayLbl="";if(pAO.LZDays&&(vDay<10))vDayLbl="0"+vDay.toString();else vDayLbl=vDay.toString();var vDefaultStyle="";var vDCFmt=pAO.DCFmt;var vBlank=false;var vSelectableCell=true;var vSDUnsel=false;var vORShw=false;var vIsWE=(vWEDay1==vDayCount)||(vWEDay2==vDayCount);if(!vDC.WkE)vDC.WkE=vIsWE;if(pAO.NoWk&&vIsWE){vDC.style.visibility="hidden";vDC.style.display="none";}PDP_SetBkColor(vDC,"");vDC.style.fontWeight="";vDC.style.color="";vDC.HLSOrig=null;vDC.title="";vDC.BSD=null;if(vFst&&pAO.ExPU)SD_InitCellPopup(pCalCId,pAO,vDC);var vSWEnd=false;var vOOR=(vHasMin&&(vCurUTC<vMinUTC))||(vHasMax&&(vMaxUTC<vCurUTC));var vDMA=(vThisMonth==vMonth)||(pAO.MV==1);if(!vDMA)if((vMV==0)&&(vRowCount==0))vDMA=true;else if((vMV==pAO.MV-1)&&(vRowCount>3))vDMA=true;if(vHiddenWeek){vDC.className="";vDayLbl="";vDC.style.height="0px";vSelectableCell=false;vBlank=true;}else if(vOOR){if(pAO.ORDays&&(pAO.OMDays||(vMonth==vThisMonth))){vDC.className=pAO.ORCSS;vSelectableCell=false;vORShw=true;}else{vDC.className="";vDayLbl="&nbsp;";vSelectableCell=false;vBlank=true;}}else if(!pAO.OMDays&&(vMonth!=vThisMonth)){vDC.className=pAO.OMCSS;vDayLbl="&nbsp;";vSelectableCell=false;vBlank=true;}else if(vDMA&&pAO.IsSelD(pAO,vDateOfCell)){if(vCurUTC==vTodayUTC){vDC.className=pAO.SelTCSS;if(vDC.className=="")vDC.style.fontWeight="bold";}else{vDC.className=pAO.SelCSS;}if(pAO.SelCSS=="")PDP_SetBkColor(vDC,"gold");pAO.SetClSl(pAO,vDC.id);if((vMonth!=vThisMonth)&&(vDC.className==""))vDC.style.color="gray";vSWEnd=pAO.WEBGSelC;}else if(vDMA&&(vCurUTC==vTodayUTC)){vDC.className=pAO.TCSS;if(vDC.className=="")vDC.style.fontWeight="bold";vSWEnd=pAO.WEBGTC;}else if(vDMA&&(pAO.SpCSS!="")&&(vCurUTC==vSpUTC)){vDC.className=pAO.SpCSS;vSWEnd=pAO.WEBGSpC;}else if(vMonth!=vThisMonth){vDC.className=pAO.OMCSS;if(vDC.className=="")vDC.style.color="gray";vSWEnd=pAO.WEBGOM;}else{vDC.className=pAO.WDCSS;vSWEnd=true;}if(vCurUTC==vSpUTC)vDC.title=pAO.SpDtTT;else if(vCurUTC==vTodayUTC)vDC.title=pAO.TodayTT;if(vSDO&&!vOOR&&!vHiddenWeek){vBSD=SD_SequentialSearch(vSDO,vDateOfCell);if(vBSD!=null){vDC.BSD=vBSD;if(!vBSD.Sel){vSDUnsel=vSelectableCell;vSelectableCell=false;}if(vDMA||pAO.MMFSDF){var vDCF=pAO.DCFmtter;if(vDCF&&vDCF.TTp){var vTTp=vDCF.TTp;if(vDCF.TTpL==null){vDCF.TTpL=vTTp.indexOf("{LABEL}")>-1;vDCF.TTpD=vTTp.indexOf("{DATE}")>-1;}if(vDCF.TTpL)vTTp=vTTp.replace("{LABEL}",vBSD.Lbl);if(vDCF.TTpD)vTTp=vTTp.replace("{DATE}",PDP_FmtDate2(vDateOfCell,vDCF.TknPat,vDCF.TknFmt));vDC.title=vTTp;}if(vDCF){var vHTML=vDCF.GetHTML(vSDO,vDCF,vBSD,vDateOfCell);if(vHTML!="")vDCFmt=vHTML;}if(!pAO.IsSelD(pAO,vDateOfCell)){if((vBSD.Css!="")&&(vMonth==vThisMonth)){vDC.className=vBSD.Css;vSWEnd=pAO.WEBGSpC;}else if((vBSD.OMCss!="")&&(vMonth!=vThisMonth)){vDC.className=vBSD.OMCss;vSWEnd=pAO.WEBGSpC;}}}}}if(vSWEnd&&vIsWE&&(pAO.WEBG!=""))PDP_SetBkColor(vDC,pAO.WEBG);if(vBlank)vDCFmt="";PDP_SetAtt(vDC,"Day",vDay);vDC.Date=vDateOfCell;if(vDCFmt!=""){if(!pAO.DayRE)pAO.DayRE=/\{0\}/g;vDayLbl=vDCFmt.replace(pAO.DayRE,vDayLbl);}PDP_SetInnerHTML(vDC,vDayLbl);var vRole=0;if(pAO.NoWk&&vIsWE)vRole=15;else if(vOOR)vRole=14;else if(vHiddenWeek)vRole=13;else if(!vSelectableCell)vRole=12;else if(vCurUTC==vTodayUTC)vRole=2;else if(vCurUTC==vSpUTC)vRole=3;else if(vMonthPos>vThisMonth)vRole=11;else if(vMonthPos<vThisMonth)vRole=10;PDP_SetAtt(vDC,"CellRole",vRole);var vMO=0;if(vMonthPos>vThisMonth)vMO=1;else if(vMonthPos<vThisMonth)vMO=-1;PDP_SetAtt(vDC,"MonthOffset",vMO);if(gPDP_Gecko&&!vCHS){var vB="1px solid "+(vRole<10?vDCBrdC:pAO.OMDCBrdC);switch(vDCBrdSd){case 0:vDC.style.border="";vDC.style.borderLeft=vB;vDC.style.borderRight=vB;break;case 1:vDC.style.border=vB;break;case 2:vDC.style.border="";vDC.style.borderTop=vB;vDC.style.borderBottom=vB;break;}}else{vDC.style.borderLeft="none";vDC.style.borderTop="none";vDC.style.borderRight="none";vDC.style.borderBottom="none";if((vRole<=12)||vORShw){var vColor=vRole<10?vDCBrdC:pAO.OMDCBrdC;if(vColor!=""){if(vDCBrdSd<2){if(!vCHS&&(vRowCount==0))vDC.style.borderBottom="1px solid "+vDCBrdC;else vDC.style.borderBottom="1px solid "+vColor;if(vCHS||!vLastHadBorder[vDayCount]||(vRowCount==0))vDC.style.borderTop="1px solid "+vColor;}if(vDCBrdSd>0){vDC.style.borderLeft="1px solid "+vColor;if(vCHS||(vDayCount==6)||(vHasMax&&(vCurUTC==vMaxUTC)))vDC.style.borderRight="1px solid "+vColor;}}vLastHadBorder[vDayCount]=true;}else if(vMonthPos<vThisMonth)vLastHadBorder[vDayCount]=false;else if(vLastHadBorder[vDayCount]&&(vMonthPos>=vThisMonth)){if(vDCBrdSd>0)if(!vCHS&&(vDayCount>0)&&vLastHadBorder[vDayCount-1])vDC.style.borderLeft="1px solid "+vDCBrdC;for(var vI=0;vI<7;vI++)vLastHadBorder[vI]=false;}}var vFnc="";vFnc=vFnc+"vDC.style.color='"+vDC.style.color+"';";if(vCHS)if(gPDP_Safari)if(vDCBrdC!="")vFnc=vFnc+"vDC.style.borderColor='"+vDCBrdC+"';";else vFnc=vFnc+"vDC.style.borderLeftColor='';vDC.style.borderRightColor='';vDC.style.borderTopColor='';vDC.style.borderBottomColor='';";else vFnc=vFnc+"vDC.style.borderColor='"+vDC.style.borderColor+"'";PDP_SetAtt(vDC,"MouseOutCode",vFnc);if(vWR.style.height==""){if(!pAO.ACH){if(vWR.clientHeight>0){pAO.ACH=vWR.clientHeight;if(pAO.ACH>pAO.WRAH)pAO.ACH=pAO.WRAH;}}if(pAO.ACH)vWR.style.height=pAO.ACH+"px";}vCurUTC=vCurUTC+86400000;vDateOfCell=new Date(vCurUTC);vMonth=vDateOfCell.getUTCMonth();vYear=vDateOfCell.getUTCFullYear();vDay=vDateOfCell.getUTCDate();if(vDay==1)vMonthPos++;vDCIdCnt++;}}vThisMonth++;if(vThisMonth>11){vThisYear++;vThisMonth=0;}vMonth=vThisMonth;vYear=vThisYear;vDay=1;}}function CSC_UpdateCmdArrows(pCalCId,pAO){var vMin=PDP_MakeUTCDate(pAO.MinY,pAO.MinM,pAO.MinD);var vMax=PDP_MakeUTCDate(pAO.MaxY,pAO.MaxM,pAO.MaxD);if(!pAO.CmdInited){pAO.CmdJB=PDP_GetById(pCalCId+"_JumpBack");pAO.CmdPM=PDP_GetById(pCalCId+"_PrevMonth");pAO.CmdJF=PDP_GetById(pCalCId+"_JumpForward");pAO.CmdNM=PDP_GetById(pCalCId+"_NextMonth");pAO.CmdInited=true;}var vH=!vMin?false:CSC_MonthDiff(pAO,vMin.getUTCFullYear(),vMin.getUTCMonth())>=0;if(pAO.CmdJB!=null)pAO.CmdJB.style.visibility=vH?"hidden":"inherit";if(pAO.CmdPM!=null)pAO.CmdPM.style.visibility=vH?"hidden":"inherit";vH=!vMax?false:CSC_MonthDiff(pAO,vMax.getUTCFullYear(),vMax.getUTCMonth())<pAO.MV;if(pAO.CmdJF!=null)pAO.CmdJF.style.visibility=vH?"hidden":"inherit";if(pAO.CmdNM!=null)pAO.CmdNM.style.visibility=vH?"hidden":"inherit";}function CSC_MVCalId(pCalId,pMV){if(pMV==0)return pCalId;else return pCalId+"_MV"+pMV;}function CSC_MVConvMY(pCalFld,pYear,pMonth){var vAO=pCalFld.AO;var vDiff=CSC_MonthDiff(vAO,pYear,pMonth);if((vDiff<0)||(vDiff>=vAO.MV))return null;return vDiff;}function CSC_MonthDiff(pAO,pYear,pMonth){var vBaseM=(pAO.Year*12)+pAO.Month;var vOffsetM=(pYear*12)+pMonth;return vOffsetM-vBaseM;}function CSC_Initialize(pCalCId,pAO){if(!gPDP_SupportsInnerHTML)return;var vCal=PDP_GetById(pCalCId);if(pAO.Inited)return;if(pAO.ExPU)SD_InitPopup(pCalCId);pAO.DateLblFld=PDP_GetById(pCalCId+"_CurrentDate");pAO.MsgBodyFld=PDP_GetById(pCalCId+"_MsgBody");pAO.WRTbls=new Array;pAO.WkRows=new Array;pAO.DHRC=new Array;for(var vMV=0;vMV<pAO.MV;vMV++){var vMCId=CSC_MVCalId(pCalCId,vMV);var vWRTbl=PDP_GetById(vMCId+"_WeekRows");pAO.WRTbls[vMV]=vWRTbl;if(vWRTbl.rows&&!gPDP_Safari){pAO.WkRows[vMV]=vWRTbl.rows;pAO.RwMd=0;}else if(vWRTbl.getElementsByTagName){pAO.WkRows[vMV]=vWRTbl.getElementsByTagName("TR");pAO.RwMd=1;}else{pAO.WkRows[vMV]=PDPUtil_GetChildNodes(vWRTbl,"TBODY",1);pAO.RwMd=2;}if(vMV==0){pAO.DHRC=PDP_GetById(vMCId+"_DayHeader")?1:0;pAO.WNRC=pAO.WkNm||pAO.SelWk||pAO.SelMth?1:0;}if(!pAO.FC){var vMOA=(pAO.MOFC!="")||(pAO.MOBdrC!="");var vCHS=vWRTbl.cellSpacing!="0";var vDCIdCnt=1;for(vRCt=0;vRCt<6;vRCt++){var vWR=CSC_GetWkRow(pAO,vMV,vRCt);for(vDCt=0;vDCt<7;vDCt++){var vDC=CSC_GetDayCell(pAO,vWR,vDCt,vMCId,vDCIdCnt);if(pAO.MSC)vDC.onclick=new Function("MSC_ClickDate('"+pCalCId+"','"+vDC.id+"');");else vDC.onclick=new Function("CSC_ChangeDay('"+pCalCId+"','"+vDC.id+"', true);");if(vMOA){vDC.onmouseover=new Function("CSC_MouseOverEffect('"+pCalCId+"', '"+vDC.id+"', "+vCHS+");");vDC.onmouseout=new Function("CSC_MouseOutEffect('"+vDC.id+"');");}if(pAO.KeyB)vDC.onfocus=new Function("CSC_SetFocus('"+vMCId+"');");vDCIdCnt++;}}}if(pAO.KeyB)CSC_InitFocus(pAO,vMV);}if(pAO.KeyB)CSC_InitKeys(vCal);if(gPDP_IEMac&&pAO.IsPopup){var vPU=PDP_GetAtt(vCal,"onpopup",'');vPU=vPU+"if (!vPUC.AO.InitSize){vPUC.style.width = '"+vCal.style.width+"';CSC_InitSize(vPUC);}";vCal.setAttribute("onpopup",vPU,0);}else if(pAO.WRTbls[0].offsetWidth!=0)CSC_InitSize(vCal);if(pAO.IVis)CSC_FillInMonth(pCalCId,true);pAO.Inited=true;}function CSC_TestInitializing(pCalCId,pMsg){var vCal=PDP_GetById(pCalCId);if(vCal.AO.Inited)return true;alert(pMsg);return false;}function CSC_InitSize(pCFld){var vAO=pCFld.AO;if(vAO.InitSize==true)return;var vCId=pCFld.id;var vWRTbl=vAO.WRTbls[0];var vCW=vWRTbl.offsetWidth*vAO.MCC;var vHT1=PDP_GetById(vCId+"_Header1");if(vHT1&&(vHT1.offsetWidth>vCW))vCW=vHT1.offsetWidth;var vHT2=PDP_GetById(vCId+"_Header2");if(vHT2&&(vHT2.offsetWidth>vCW))vCW=vHT2.offsetWidth;var vHT3=PDP_GetById(vCId+"_Header3");if(vHT3&&(vHT3.offsetWidth>vCW))vCW=vHT3.offsetWidth;var vFT1=PDP_GetById(vCId+"_Footer1");if(vFT1&&(vFT1.offsetWidth>vCW))vCW=vFT1.offsetWidth;var vFT2=PDP_GetById(vCId+"_Footer2");if(vFT2&&(vFT2.offsetWidth>vCW))vCW=vFT2.offsetWidth;var vFT3=PDP_GetById(vCId+"_Footer3");if(vFT3&&(vFT3.offsetWidth>vCW))vCW=vFT3.offsetWidth;var vCCW=0;if(pCFld.clientWidth)vCCW=pCFld.clientWidth;else vCCW=pCFld.offsetWidth;if(vCCW>vCW)vCW=vCCW;var vLB=0;if(gPDP_Opera7){vLB=PDP_GetLeftBorder(pCFld)+parseInt(pCFld.style.paddingLeft);pCFld.style.width=(vCW+vLB*2)+"px";}else pCFld.style.width=vCW+"px";var vWRTW=Math.round((vCW-vLB*2)/vAO.MCC);if(vAO.MCC>1){var vP=PDP_ParentNode(vAO.WRTbls[0]);var vPLB=PDP_GetLeftBorder(vP);var vPPL=0;if(vP.clientWidth&&vP.offsetWidth)vPPL=vP.offsetWidth-vP.clientWidth;vWRTW=vWRTW-vPLB-vPPL;}vWRTW=vWRTW+"px";for(var vMV=0;vMV<vAO.MV;vMV++){var vT=vAO.WRTbls[vMV];vT.style.width=vWRTW;}if(!gPDP_IEWin||gPDP_IEWin7){var vLst=vAO.WRTbls[vAO.WRTbls.length-1];var vLstR=PDP_GetOffsetX(vLst,vLst.offsetLeft,1)+vLst.offsetWidth;var vLstL=PDP_GetOffsetX(vWRTbl,vWRTbl.offsetLeft,1);var vCalL=PDP_GetOffsetX(pCFld,pCFld.offsetLeft,1);var vCalR=vCalL+pCFld.offsetWidth;var vGap=vLstL-vCalL;var vLB=PDP_GetLeftBorder(pCFld);var vU=false;if(gPDP_Opera9){vU=false;}else if(gPDP_Opera7){vGap-=vLB;if(vAO.MV>1)vGap+=vAO.MCC;vU=true;}else if(!gPDP_Safari||!vAO.IsPopup){vGap-=vLB;if((vLstR+vGap)>vCalR)vU=true;}else{if(vAO.MV>1)vGap+=(vLB+3)*vAO.MCC;else vGap+=vLB+2;vU=true;}if(vU)pCFld.style.width=(vLstR-vLstL+(vGap*2))+"px";}var vFW="100%";if(gPDP_IEWin&&pCFld.clientWidth)vFW=pCFld.clientWidth-PDP_GetLeftBorder(pCFld)+"px";else if(gPDP_Safari||gPDP_IEWin)vFW=vCW+"px";if(vHT1)vHT1.style.width=vFW;if(vHT2)vHT2.style.width=vFW;if(vHT3)vHT3.style.width=vFW;if(vFT1)vFT1.style.width=vFW;if(vFT2)vFT2.style.width=vFW;if(vFT3)vFT3.style.width=vFW;var vMC=PDP_GetById(vCId+"_MsgCenter");if(vMC)vMC.style.width=vFW;pCFld.AO.InitSize=true;if(pCFld.AO.SdFX)PDP_AddShadow(pCFld);}function CSC_GetWkRow(pAO,pMV,pRN){var vAR=pRN+pAO.DHRC;var vWR=pAO.WkRows[pMV];switch(pAO.RwMd){case 0:return vWR[vAR];case 1:return vWR.item(vAR);default:return PDPUtil_GetChildNodes(vWR,"TR",vAR+1);}}function CSC_GetDayCell(pAO,pWkRow,pCN,pMVId,pIdCnt){var vAC=pCN+pAO.WNRC;switch(pAO.RwMd){case 0:return pWkRow.cells[vAC];case 1:return PDP_GetById(pMVId+"_"+pIdCnt);default:return PDPUtil_GetChildNodes(pWkRow,"TD",vAC+1);}}function CSC_Show(pCSCId){var vCFld=PDP_GetById(pCSCId);if(!vCFld.AO)return;var vC=vCFld.style.width.charAt(0);if((vC=="")||(vC=="0")){vCFld.AO.InitSize=false;CSC_InitSize(vCFld);}}function CSC_ChangeDay(pCalCId,pDCId,pFB){var vCal=PDP_GetById(pCalCId);var vAO=vCal.AO;if(vAO.KeyB)CSC_SetFocus(pCalCId);if(!vAO.IsClSl(vAO,pDCId)){var vNewDC=null;var vNewRole=0;if(pDCId!=""){vNewDC=PDP_GetById(pDCId);vNewRole=parseInt(PDP_GetAtt(vNewDC,"CellRole","0"));if(vNewRole>=12)return;}if(vAO.HasClSl(vAO)){if(vAO.SelCell)CSC_UnselectDayCell(vAO,vAO.SelCell);else if(vAO.SelCells)for(var vI=0;vI<vAO.SelCells.length;vI++)CSC_UnselectDayCell(vAO,vAO.SelCells[vI]);vAO.ClearClSl(vAO);}vAO.SetDV(vAO,null);if(vNewDC!=null){CSC_SelectDayCell(vAO,vNewDC);vAO.SetClSl(vAO,pDCId);vAO.SetDV(vAO,vNewDC.Date);}CSC_DrawDateLabel(vCal);if(pFB)CSC_OnSelectionChanged(vCal,false);}else if(pFB&&(pDCId!="")&&vAO.IsPopup)CSC_OnSelectionChanged(vCal,true);}function CSC_SelectDayCell(pAO,pCellId){var vDC=typeof(pCellId)=="string"?PDP_GetById(pCellId):pCellId;PDP_SetBkColor(vDC,"");vDC.style.fontWeight="";if(vDC.background)vDC.background="";var vRole=parseInt(PDP_GetAtt(vDC,"CellRole","0"));if(vRole==2){vDC.className=pAO.SelTCSS;if(vDC.className=="")vDC.style.fontWeight="bold";}else{vDC.className=pAO.SelCSS;}if(vDC.className=="")PDP_SetBkColor(vDC,"gold");}function CSC_UnselectDayCell(pAO,pCellId){var vDC=typeof(pCellId)=="string"?PDP_GetById(pCellId):pCellId;var vRole=parseInt(PDP_GetAtt(vDC,"CellRole","0"));PDP_SetBkColor(vDC,"");vDC.style.fontWeight="";vDC.style.color="";if(vDC.background)vDC.background="";vDC.className="";var vWE=false;switch(vRole){case 0:vDC.className=pAO.WDCSS;vWE=true;break;case 2:vDC.className=pAO.TCSS;if(vDC.className=="")vDC.style.fontWeight="bold";vWE=pAO.WEBGTC;break;case 3:vDC.className=pAO.SpCSS;vWE=pAO.WEBGSpC;break;case 10:case 11:vDC.className=pAO.OMCSS;if(vDC.className=="")vDC.style.color="gray";vWE=pAO.WEBGOM;break;}if(vWE&&(eval(PDP_GetAtt(vDC,"WkE"))))PDP_SetBkColor(vDC,pAO.WEBG);if(pAO.SDId!=""){if(vDC.Date){var vBSD=SD_FindDate(pAO.SDId,vDC.Date);if(vBSD!=null){if((vBSD.Css!="")&&(vRole<10))vDC.className=vBSD.Css;else if((vBSD.OMCss!="")&&(vRole>=10))vDC.className=vBSD.OMCss;}}}if(vDC.onmouseout!=null){PDP_FireEvent(vDC,'mouseout','MouseEvents');}}function CSC_OnSelectionChanged(pCalFld,pApply){if(window.SD_ClosePopup)SD_ClosePopup(false);var vAO=pCalFld.AO;if(vAO.KeyB)CSC_SetFocus(pCalFld.id);if(!pApply){if(vAO.AChgN)pApply=true;}if(pApply){if(vAO.OnSelChg)eval(vAO.OnSelChg);if(vAO.OSC)vAO.OSC(vAO);switch(vAO.SelChgC){case"yes":PDP_ClosePopup();break;case"noapplycmd":if(!vAO.ApMd)PDP_ClosePopup();break;}}}function CSC_UpdateOther(pAO){if(pAO.C2UID){var vC2U=PDP_GetById(pAO.C2UID);if(vC2U){var vValue=PDP_FmtDate2(pAO.SelDate,pAO.DPC2U,pAO.DFC2U);if((vC2U.value!=null)&&(vC2U.nodeName=="INPUT")){if(!vC2U.isMultiLine)vC2U.value=vValue;}else{vC2U.innerHTML=vValue}}}}function CSC_MouseOverEffect(pCalCId,pDCId,pCellsHaveSpacing){var vCal=PDP_GetById(pCalCId);var vAO=vCal.AO;if(!vAO)return;var vDC=PDP_GetById(pDCId);if(!vDC)return;var vRole=parseInt(PDP_GetAtt(vDC,"CellRole","0"));if(vRole>=12)return;if(pCellsHaveSpacing&&(vAO.MOBdrC!=""))vDC.style.borderColor=vAO.MOBdrC;if(vAO.MOFC!="")vDC.style.color=vAO.MOFC;}function CSC_MouseOutEffect(pDCId){var vDC=PDP_GetById(pDCId);if(vDC){var vCode=PDP_GetAtt(vDC,"MouseOutCode","");eval(vCode);}}function CSC_AssignDate(pCalFld,pYear,pMonth,pDay,pFB){var vMV=CSC_MVConvMY(pCalFld,pYear,pMonth);if(vMV==null)return;var vAO=pCalFld.AO;var vDCIdCnt=1;for(var vRCt=0;vRCt<6;vRCt++){var vWR=CSC_GetWkRow(vAO,vMV,vRCt);for(var vCCt=0;vCCt<7;vCCt++){var vDC=CSC_GetDayCell(vAO,vWR,vCCt,pCalFld.id,vDCIdCnt);var vRole=parseInt(PDP_GetAtt(vDC,"CellRole","0"));if(vRole<10){var vDay=PDP_GetAtt(vDC,"Day",0);if(vDay==pDay){CSC_ChangeDay(pCalFld.id,vDC.id,pFB);return;}}vDCIdCnt++;}}}function CSC_FillInMonthHeader(pCalCId){var vMYL=PDP_GetById(pCalCId+"_MonthYearLabel");if(vMYL){var vCal=PDP_GetById(pCalCId);var vAO=vCal.AO;var vYL=PDP_GetById(pCalCId+"_YearLabel");var vMYText="";var vEMYText="";var vY=vEY=vAO.Year;var vM=vEM=vAO.Month;var vTwo=false;if(vAO.MV>1){var vDO=CSC_AddMonths(vY,vM,vAO.MV-1);vEY=vDO.Y;vEM=vDO.M;if(vAO.MaxY!=null){var vDiff=(vAO.MaxY*12+vAO.MaxM)-(vEY*12+vEM);if(vDiff<0){vEY=vAO.MaxY;vEM=vAO.MaxM;}}vTwo=vY!=vEY||vM!=vEM;}if(vAO.AMN){vMYText=PDP_AbbrevMonths[vM];vEMYText=PDP_AbbrevMonths[vEM];}else{vMYText=PDP_Months[vM];vEMYText=PDP_Months[vEM];}switch(vAO.ShowYear){case"rightofmonth":vMYText=vMYText+" "+vY;if(vTwo)vMYText+=vAO.MMSp+vEMYText+" "+vEY;break;case"leftofmonth":vMYText=vY+" "+vMYText;if(vTwo)vMYText+=vAO.MMSp+vEY+" "+vEMYText;break;case"belowmonth":if(vYL){vYL.innerHTML=vY+((vY!=vEY)?vAO.MMSp+vEY:"");}if(vTwo)vMYText+=vAO.MMSp+vEMYText;break;case"no":if(vTwo)vMYText+=vAO.MMSp+vEMYText;break;}vMYL.innerHTML=vMYText;}}function CSC_DrawDateLabel(pCalFld){var vAO=pCalFld.AO;if(vAO.DateLblFld)vAO.DateLblFld.innerHTML=vAO.GetDL(vAO);if(vAO.MsgBodyFld)MSC_DrawMsgBody(vAO);}function CSC_GetDateLabel(pAO){return PDP_FmtDate2(pAO.SelDate,pAO.CurDPat,pAO.CurDFmt);}function CSC_IsCurrentMonth(pCalFld,pYear,pMonth){return CSC_MVConvMY(pCalFld,pYear,pMonth)!=null;}function CSC_OnClickMonthChangeCommands(pCalCId,pCommandId,pMonthCount){var vCmdFld=PDP_GetById(pCommandId);if(vCmdFld.style.visibility!="hidden"){CSC_ViewMonthByCount(pCalCId,pMonthCount);if(window.CSC_SetFocus)CSC_SetFocus(pCalCId);}}function CSC_TransferMonthYearToCalendar(pMYPId){var vMYAO=PDP_GetById(pMYPId).AO;var vCalCId=vMYAO.CalId;var vMonth=vMYAO.Format==1?MYP_GetMonth(pMYPId):FMP_GetMonth(pMYPId);var vYear=vMYAO.Format==1?MYP_GetYear(pMYPId):FMP_GetYear(pMYPId);if((vMonth>0)||(vYear>0)){if(vYear==0)CSC_ViewMonth(vCalCId,vMonth-1);else if(vMonth==0)CSC_ViewYear(vCalCId,vYear);else CSC_ViewDate(vCalCId,vYear,vMonth-1);if(window.CSC_SetFocus)CSC_SetFocus(vCalCId,false);}}function CSC_OnPopupMonthYearPicker(pCalCId){var vCal=PDP_GetById(pCalCId);var vAO=vCal.AO;var vMYP=PDP_GetById(vAO.MYPId);vMYP.AO.MinY=vAO.MinY?vAO.MinY:0;vMYP.AO.MinM=vAO.MinM?vAO.MinM+1:0;vMYP.AO.MaxY=vAO.MaxY?vAO.MaxY:0;vMYP.AO.MaxM=vAO.MaxM?vAO.MaxM+1:0;vMYP.AO.Today=PDP_MakeUTCDate(vAO.TodayY,vAO.TodayM,vAO.TodayD);vMYP.AO.CalId=pCalCId;if(vMYP.AO.Format==1)MYP_SelectMonthYear(vAO.MYPId,vAO.Month+1,vAO.Year);else FMP_SelectMonthYear(vAO.MYPId,vAO.Month+1,vAO.Year);PDP_OpenPopup(pCalCId+"_MYP_TG",vAO.MYPId,false);}function CSC_DateSelectable(pCalFld,pYear,pMonth,pDay){var vAO=pCalFld.AO;var vDate=PDP_MakeUTCDate(pYear,pMonth,pDay);if(vAO.NoWk){var vDOW=vDate.getUTCDay();if((vDOW==0)||(vDOW==6))return false;}if(vAO.SDId!=""){var vSD=SD_FindDate(vAO.SDId,vDate);if((vSD!=null)&&!vSD.Sel)return false;}return true;}function CSC_EnableMenuItem(pMnID,pCmdID){switch(pCmdID){case 32:return PDP_GetById(gPDPMenuToken1).AO.ClrCmd!=1;case 3:return PDP_GetById(gPDPMenuToken1).AO.SpecialY!=null;case 100:return PDP_GetById(gPDPMenuToken1).AO.SDId!="";case 14:return PDP_GetById(gPDPMenuToken1).AO.MYPId!=null;}return true;}function CSC_IsSelDate(pAO,pDate){CSC_PrepSelDate(pAO);if(pDate)return pDate.valueOf()==pAO.SelDateTicks;else return false;}function CSC_PrepSelDate(pAO){if(pAO.SelDateTicks==null){var vF=PDP_GetById(pAO.CID+"_SelDate");if(vF.value==""){pAO.SelDateTicks=0;pAO.SelDate=null;}else{var vP=vF.value.split('|');pAO.SelDate=PDP_MakeUTCDate(parseInt(vP[0]),parseInt(vP[1])-1,parseInt(vP[2]));pAO.SelDateTicks=pAO.SelDate.valueOf();}}}function CSC_GetDV(pAO){CSC_PrepSelDate(pAO);return pAO.SelDate;}function CSC_SetDV(pAO,pDate){pAO.SelDate=pDate;var vH=PDP_GetById(pAO.CID+"_SelDate");if(pDate==null){pAO.SelDateTicks=0;vH.value="";}else{pAO.SelDateTicks=pAO.SelDate.valueOf();vH.value=pDate.getUTCFullYear()+"|"+(pDate.getUTCMonth()+1)+"|"+pDate.getUTCDate();}}function CSC_SetMV(pAO,pY,pM){pAO.Month=pM;pAO.Year=pY;var vH=PDP_GetById(pAO.CID+"_MonthView");pM++;vH.value=pY+"|"+pM;}function CSC_HasCellSel(pAO){return pAO.SelCell!=null;}function CSC_ClearCellSel(pAO){pAO.SelCell=null;}function CSC_SetCellSel(pAO,pCellId){pAO.SelCell=pCellId;}function CSC_IsCellSel(pAO,pCellId){return pAO.SelCell==pCellId;}function CSC_FirstClSl(pAO){return pAO.SelCell;}function CSC_GetDate(pCalCId){var vAO=PDP_GetById(pCalCId).AO;var vDate=vAO.GetDV(vAO);if(vDate)return new Date(vDate.getUTCFullYear(),vDate.getUTCMonth(),vDate.getUTCDate());else return null;}function CSC_GetDateString(pCalCId,pPattern,pFormat){var vAO=PDP_GetById(pCalCId).AO;return PDP_FmtDate2(vAO.GetDV(vAO),pPattern,pFormat);}function CSC_GetYear(pCalCId){var vAO=PDP_GetById(pCalCId).AO;var vD=vAO.GetDV(vAO);return vD?vD.getUTCFullYear():-1;}function CSC_GetMonth(pCalCId){var vAO=PDP_GetById(pCalCId).AO;var vD=vAO.GetDV(vAO);return vD?vD.getUTCMonth():-1;}function CSC_GetDay(pCalCId){var vAO=PDP_GetById(pCalCId).AO;var vD=vAO.GetDV(vAO);return vD?vD.getUTCDate():-1;}function CSC_SetDate(pCalCId,pY,pM,pDay,pChangeMonth,pFB){var vCal=PDP_GetById(pCalCId);var vAO=vCal.AO;var vVal=true;if(!CSC_DateSelectable(vCal,pY,pM,pDay)){vVal=false;vAO.SetDV(vAO,null);}if(vVal){vAO.SetDV(vAO,PDP_MakeUTCDate(pY,pM,pDay));}if(vVal&&vAO.MonthLoaded&&CSC_IsCurrentMonth(vCal,pY,pM)){CSC_AssignDate(vCal,pY,pM,pDay,pFB);}else{if(pChangeMonth){var vDO=CSC_LimitToMaxDate(vAO,pY,pM);pY=vDO.Y;pM=vDO.M;var vMode=pFB?CSC_GetMCMode(vAO,pY,pM):-1;CSC_SetMV(vAO,pY,pM);CSC_MonthValueChanged(pCalCId,true,vMode);}else CSC_FillInMonth(pCalCId,true);}if(pFB)CSC_OnSelectionChanged(vCal,false);return true;}function CSC_SetNoSelection(pCalCId,pShowTodayMonth,pFB){var vCal=PDP_GetById(pCalCId);var vAO=vCal.AO;vAO.SetDV(vAO,null);if(pFB){CSC_OnSelectionChanged(vCal,false);if(vCal.style.visibility=="hidden")return;}if(pShowTodayMonth){var vMode=pFB?CSC_GetMCMode(vAO,vAO.TodayY,vAO.TodayM):-1;var vMY=CSC_LimitToMaxDate(vAO,vAO.TodayY,vAO.TodayM);vMY=CSC_LimitToMinDate(vAO,vMY.Y,vMY.M);CSC_SetMV(vAO,vMY.Y,vMY.M);CSC_MonthValueChanged(pCalCId,true,vMode);}else CSC_FillInMonth(pCalCId,true);}function CSC_GetMCMode(pAO,pYear,pMonth){var vDif=(pYear*12+pMonth)-(pAO.Year*12+pAO.Month);var vMode=0;if(vDif==pAO.MV)vMode=1;else if(vDif==-pAO.MV)vMode=0;else if(Math.abs(vDif)>1)vMode=2;return vMode;}function CSC_ViewDate(pCalCId,pYear,pMonth){var vCal=PDP_GetById(pCalCId);var vAO=vCal.AO;if((vAO.Year==pYear)&&(vAO.Month==pMonth))return;var vMode=CSC_GetMCMode(vAO,pYear,pMonth);CSC_SetMV(vAO,pYear,pMonth);CSC_MonthValueChanged(pCalCId,false,vMode);}function CSC_ViewMonth(pCalCId,pMonth){var vCal=PDP_GetById(pCalCId);if(vCal.AO.Month==pMonth)return;CSC_ViewDate(pCalCId,vCal.AO.Year,pMonth);}function CSC_ViewYear(pCalCId,pYear){var vCal=PDP_GetById(pCalCId);if(vCal.AO.Year==pYear)return;CSC_ViewDate(pCalCId,pYear,vCal.AO.Month);}function CSC_GetViewedMonth(pCalCId){return PDP_GetById(pCalCId).AO.Month;}function CSC_GetViewedYear(pCalCId){return PDP_GetById(pCalCId).AO.Year;}function CSC_JumpMonths(pCalId,pFwd){var vAO=PDP_GetById(pCalId).AO;var vI=pFwd?1:-1;CSC_ViewMonthByCount(pCalId,vI*vAO.JBy);}function CSC_ViewMonthByCount(pCalCId,pJumpMonths){if(pJumpMonths==0)return;var vCal=PDP_GetById(pCalCId);var vAO=vCal.AO;var vY=vAO.Year;var vM=vAO.Month;if(pJumpMonths>0){var vDO=CSC_AddMonths(vY,vM,pJumpMonths);vDO=CSC_LimitToMaxDate(vAO,vDO.Y,vDO.M);vY=vDO.Y;vM=vDO.M;}else{var vDO=CSC_AddMonths(vY,vM,pJumpMonths);vDO=CSC_LimitToMinDate(vAO,vDO.Y,vDO.M);vY=vDO.Y;vM=vDO.M;}var vMode=CSC_GetMCMode(vAO,vY,vM);CSC_SetMV(vAO,vY,vM);CSC_MonthValueChanged(pCalCId,false,vMode);}function CSC_LimitToMaxDate(pAO,pY,pM){if(pAO.MaxY!=null){var vDiff=(pAO.MaxY*12+pAO.MaxM)-(pY*12+pM);if(vDiff<pAO.MV)return CSC_AddMonths(pAO.MaxY,pAO.MaxM,1-pAO.MV);}return{M:pM,Y:pY};}function CSC_LimitToMinDate(pAO,pY,pM){if(pAO.MinY!=null)if((pY<pAO.MinY)||((pY==pAO.MinY)&&(pM<pAO.MinM))){pY=pAO.MinY;pM=pAO.MinM;}return{M:pM,Y:pY};}function CSC_AddMonths(pYear,pMonth,pAdd){var vNew=pYear*12+pMonth+pAdd;return{M:vNew%12,Y:Math.round((vNew/12)-0.5)};}function CSC_MonthValueChanged(pCalId,pDrawDateLabel,pMode){if(window.SD_ClosePopup)SD_ClosePopup(false);var vCal=PDP_GetById(pCalId);var vAO=vCal.AO;if(vAO.OnMVChg){var vStop=false;eval(vAO.OnMVChg);if(vStop)return;}var vWR=vAO.WRTbls[0];if(vAO.MV>1)vWR=PDP_GetById(pCalId+"_WRC");var vFlt=((pMode!=-1)&&vAO.MCFX&&window.PDP_MonthTransform)?PDP_MonthTransform(vWR,pMode):null;CSC_FillInMonth(pCalId,pDrawDateLabel);if(vFlt){vFlt.play();vWR.style.backgroundColor="";}CSC_Callback(vCal);}function CSC_Callback(pCal){var vAO=pCal.AO;if(vAO.Callback){var vM=vAO.Month+1;var vCB=vAO.Callback.replace("{0}",vAO.Year.toString()+"|"+vM.toString());eval(vCB);var vCBS=PDP_GetById(pCal.id+"_CBS");if(vCBS)vCBS.style.display="block";}}function CSC_ShowSelection(pCalCId){var vCal=PDP_GetById(pCalCId);var vAO=vCal.AO;if(vAO.KeyB)CSC_SetFocus(pCalCId);var vD=vAO.GetDV(vAO);if(!vD)return;if(!vAO.FirstClSl(vAO)){var vDO=CSC_LimitToMaxDate(vAO,vD.getUTCFullYear(),vD.getUTCMonth());var vY=vDO.Y;var vM=vDO.M;var vMode=CSC_GetMCMode(vAO,vY,vM);CSC_SetMV(vAO,vY,vM);CSC_MonthValueChanged(pCalCId,false,vMode);}}function CSC_ShowToday(pCalCId,pFB){var vCal=PDP_GetById(pCalCId);var vAO=vCal.AO;CSC_SetDate(pCalCId,vAO.TodayY,vAO.TodayM,vAO.TodayD,true,pFB);}function CSC_ShowSpecial(pCalCId,pFB){var vCal=PDP_GetById(pCalCId);var vAO=vCal.AO;if(vAO.SpecialY!=null){CSC_SetDate(pCalCId,vAO.SpecialY,vAO.SpecialM,vAO.SpecialD,true,pFB);}}function CSC_Apply(pCalCId){var vCal=PDP_GetById(pCalCId);CSC_OnSelectionChanged(vCal,true);if(vCal.AO.IsPopup)PDP_ClosePopup();}function CSC_ClearCmd(pCalCId){if(!PDP_GetById(pCalCId).AO.ClrCmd)CSC_SetNoSelection(pCalCId,false,true);}