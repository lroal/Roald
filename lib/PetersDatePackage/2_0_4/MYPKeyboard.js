// Copyright 2002 - 2007 Peter L. Blum, All Rights Reserved, www.PeterBlum.com
// Peter's Date Package Release 2.0.4

function MYP_InitKeys(pMYPFld){if(gPDP_SupportsFocusOnTable&&(pMYPFld.attachEvent!=null)){pMYPFld.attachEvent("onkeydown",new Function("return MYP_OnKeyDownIE('"+pMYPFld.id+"');"));pMYPFld.attachEvent("onkeypress",new Function("return MYP_OnKeyPressIE('"+pMYPFld.id+"');"));}else if(pMYPFld.addEventListener!=null){var vPU=PDP_GetAtt(pMYPFld,"onpopup",'');var vPD=PDP_GetAtt(pMYPFld,"onpopdown",'');PDP_SetAtt(pMYPFld,"onpopup",vPU+"MYP_AttachKeyboardNS();");PDP_SetAtt(pMYPFld,"onpopdown",vPD+"MYP_DetachKeyboardNS();");}}function MYP_AttachKeyboardNS(){document.addEventListener("keydown",MYP_OnKeyDownDOM,false);document.addEventListener("keypress",MYP_OnKeyPressDOM,false);}function MYP_DetachKeyboardNS(){document.removeEventListener("keydown",MYP_OnKeyDownDOM,false);document.removeEventListener("keypress",MYP_OnKeyPressDOM,false);}function MYP_OnKeyDownIE(pMYPId){return MYP_OnKeyDownBody(window.event,pMYPId);}function MYP_OnKeyDownDOM(pE){if((gPUNPos==-1)||(gPopupCId[gPUNPos]==""))return false;var vId=gPopupCId[gPUNPos];var vOT=document.getElementById(vId+"_OuterTable");if(vOT!=null)return MYP_OnKeyDownBody(pE,vId);else return false;}function MYP_OnKeyDownBody(pE,pMYPId){var vMYPFld=PDP_GetById(pMYPId);var vKeyCode=PDP_GetKeyCode(pE);var vShift=PDP_IsShift(pE);var vCtrl=PDP_IsCtrl(pE);if(((vKeyCode>=33)&&(vKeyCode<=47))||(vKeyCode==27)){if(MYP_ArrowKeyProcessing(vMYPFld,vKeyCode))PDP_StopEvent(pE);else if(MYP_CommandKeyProcessing(vMYPFld,vKeyCode,vShift,vCtrl))PDP_StopEvent(pE);return false;}else if(vKeyCode==9){if(vMYPFld.AO.IsPopup){PDP_CloseAllPopups();PDP_StopEvent(pE);return false;}}return true;}function MYP_OnKeyPressIE(pMYPId){return MYP_OnKeyPressBody(window.event,pMYPId);}function MYP_OnKeyPressDOM(pE){if((gPUNPos==-1)||(gPopupCId[gPUNPos]==""))return false;var vId=gPopupCId[gPUNPos];var vOT=document.getElementById(vId+"_OuterTable");if(vOT!=null)return MYP_OnKeyPressBody(pE,vId);else return false;}function MYP_OnKeyPressBody(pE,pMYPId){var vKeyCode=PDP_GetKeyCode(pE);var vShift=PDP_IsShift(pE);var vCtrl=PDP_IsCtrl(pE);if(((vKeyCode<33)||(vKeyCode>47))&&(vKeyCode!=27)){var vMYPFld=PDP_GetById(pMYPId);var vTemp=(MYP_DigitKeyProcessing(vMYPFld,vKeyCode)||MYP_AlphaKeyProcessing(vMYPFld,vKeyCode)||MYP_CommandKeyProcessing(vMYPFld,vKeyCode,vShift,vCtrl));}PDP_StopEvent(pE);return false;}function MYP_ArrowKeyProcessing(pMYPFld,pKeyCode){switch(pKeyCode){case 38:MYP_MoveMonthSelection(pMYPFld.id,-1);break;case 40:MYP_MoveMonthSelection(pMYPFld.id,1);break;case 37:MYP_MoveMonthSelection(pMYPFld.id,-6);break;case 39:MYP_MoveMonthSelection(pMYPFld.id,6);break;default:return false;}return true;}function MYP_DigitKeyProcessing(pMYPFld,pKeyCode){if((pKeyCode>=48)&&(pKeyCode<=57)){var vKeyCodeStr=String.fromCharCode(pKeyCode);MYP_TypeToCell(pMYPFld,vKeyCodeStr,true);return true;}else return false;}function MYP_AlphaKeyProcessing(pMYPFld,pKeyCode){if(((pKeyCode>=65)&&(pKeyCode<=90))||((pKeyCode>=97)&&(pKeyCode<=122))){var vKCStr=String.fromCharCode(pKeyCode).toUpperCase();MYP_TypeToCell(pMYPFld,vKCStr,false);return true;}else return false;}function MYP_CommandKeyProcessing(pMYPFld,pKeyCode,pShiftKey,pCtrlKey){var vResult=true;switch(pKeyCode){case 33:if(PDP_GetById(pMYPFld.id+"_PrevYears").style.visibility!="hidden"){MYP_FillInYearTable(pMYPFld.id,-pMYPFld.AO.MYBy);MYP_OnSelectionChanged(pMYPFld,false);}break;case 34:if(PDP_GetById(pMYPFld.id+"_NextYears").style.visibility!="hidden"){MYP_FillInYearTable(pMYPFld.id,pMYPFld.AO.MYBy);MYP_OnSelectionChanged(pMYPFld,false);}break;case 13:MYP_Apply(pMYPFld.id);break;case 27:MYP_ClosePopup(pMYPFld);break;default:vResult=false;break;}return vResult;}var gTypeToCell="";var gTypeToCellTimer=0;var gTypeToDigitMode=true;function MYP_TypeToCell(pMYPFld,pKeyCodeStr,pDigit){if(gTypeToCellTimer!=0){window.clearInterval(gTypeToCellTimer);gTypeToCellTimer=0;}if(gTypeToDigitMode!=pDigit){gTypeToCell="";gTypeToDigitMode=pDigit;}if(pDigit){if(gTypeToCell.length==4)gTypeToCell=pKeyCodeStr;else gTypeToCell=gTypeToCell+pKeyCodeStr;for(var vI=0;vI<10;vI++){var vNewCellId=pMYPFld.id+"_YC_"+vI;var vValue=PDP_GetById(vNewCellId).Year.toString();if(gTypeToCell.length==1){if(vValue.lastIndexOf(gTypeToCell)==vValue.length-gTypeToCell.length){MYP_YearOnClick(pMYPFld.id,vNewCellId);break;}}else if(vValue.indexOf(gTypeToCell)==0){MYP_YearOnClick(pMYPFld.id,vNewCellId);break;}}}else{if(gTypeToCell.length==3)gTypeToCell=pKeyCodeStr;else gTypeToCell=gTypeToCell+pKeyCodeStr;var vRE=new RegExp(">\D*<");for(var vI=0;vI<12;vI++){var vNewCellId=pMYPFld.id+"_MC_"+vI;var vValue=PDP_GetById(vNewCellId).innerHTML;if(vValue.charAt(0)=="<")return;vValue=vValue.toUpperCase();if(vValue.indexOf(gTypeToCell)==0){MYP_MonthOnClick(pMYPFld.id,vNewCellId);break;}}}gTypeToCellTimer=window.setInterval("gTypeToCell = '';",1500);}