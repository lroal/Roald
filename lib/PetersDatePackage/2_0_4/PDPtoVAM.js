// Copyright 2002 - 2007 Peter L. Blum, All Rights Reserved, www.PeterBlum.com
// Peter's Date Package Release 2.0.4

function PDP2VAM_ConvDate(pCO,pText){return PDP2VAM_ConvDTBBody(pCO.IDToEval,pText);}function PDP2VAM_ConvTime(pCO,pText){return PDP2VAM_ConvTMTBBody(pCO.IDToEval,pText,pCO.TimeOnly!=false);}function PDP2VAM_ConvTimeDate(pCO,pText){var vFld=PDP_GetById(pCO.IDToEval);var vDTBId=vFld.AO?vFld.AO.DTBId:PDP_GetAtt(vFld,"DTBId","");if(vDTBId=="")return null;var vPos=pText.indexOf("~");if(vPos==-1)vPos=pText.indexOf(" ");if(vPos==-1)return null;var vDateText=pText.substr(0,vPos);var vTimeText=pText.substr(vPos+1,pText.length);var vDate=DTB_ParseDate(vDTBId,vDateText);var vTime=TMTB_ParseTime(pCO.IDToEval,vTimeText);if((vDate==null)||(vTime==null))return null;vDate=new Date(vDate.getFullYear(),vDate.getMonth(),vDate.getDate(),PDP_Trunc(vTime/3600),PDP_Trunc((vTime/60)%60),vTime%60,0);return vDate.valueOf();}function PDP2VAM_ConvCalDate(pCO,pText){return VAM_DateConv(pCO,pText);}function PDP2VAM_ConvDTB(pCO,pID){var vVal=VAM_GetTextValue(pID,pCO.Trim);if(vVal==""){gVAMCanEval=false;return null;}else{gVAMCanEval=true;return PDP2VAM_ConvDTBBody(pID,vVal);}}function PDP2VAM_ConvTMTB(pCO,pID){var vVal=VAM_GetTextValue(pID,pCO.Trim);if(vVal==""){if(gVAMSubmitEvent){var vFld=PDP_GetById(pID);var vDTBId=vFld.AO?vFld.AO.DTBId:PDP_GetAtt(vFld,"DTBId","");if(vDTBId!=""){if(PDP_GetById(vDTBId).value!=""){gVAMCanEval=true;return null;}}}gVAMCanEval=false;return null;}else{gVAMCanEval=true;return PDP2VAM_ConvTMTBBody(pID,vVal,pCO.TimeOnly!=false);}}function PDP2VAM_ConvCal(pCO,pID){gVAMCanEval=true;var vDate=CSC_GetDate(pID);return vDate!=null?vDate.valueOf():null;}function PDP2VAM_ConvDTBBody(pTBId,pText){var vTBFld=PDP_GetById(pTBId);var vDate=null;if(vTBFld.AltParse)vDate=vTBFld.AltParse(vTBFld,pText,null);if(vDate==null)vDate=DTB_ParseDate(pTBId,pText);return vDate!=null?vDate.valueOf():null;}function PDP2VAM_ConvTMTBBody(pTMId,pText,pTimeOnly){var vFld=PDP_GetById(pTMId);var vDTBId=vFld.AO?vFld.AO.DTBId:PDP_GetAtt(vFld,"DTBId","");if(!pTimeOnly&&(vDTBId!="")){var vDate=DTB_GetDateValue(vDTBId);var vTime=TMTB_ParseTime(pTMId,pText);if((vDate==null)||(vTime==null)){gVAMCanEval=(vFld.value!="")||(PDP_GetById(vDTBId).value!="");return null;}if((vDTBId!=null)&&(vTime>86399))return null;vDate=new Date(vDate.getFullYear(),vDate.getMonth(),vDate.getDate(),PDP_Trunc(vTime/3600),PDP_Trunc((vTime/60)%60),vTime%60,0);return vDate.valueOf();}else{var vTime=TMTB_ParseTime(pTMId,pText);if(vTime==null)return null;if((vDTBId!=null)&&(vTime>86399))return null;return vTime;}}function PDP2VAM_HUTimeDate(pCO,pAO,pFldID){var vFld=PDP_GetById(pFldID);VAM_HookupControl(vFld,pAO,null);var vDTBId=vFld.AO?vFld.AO.DTBId:PDP_GetAtt(vFld,"DTBId","");if(vDTBId!="")VAM_HookupControl(PDP_GetById(vDTBId),pAO,null);}function PDP2VAM_HUCal(pCO,pAO,pFldID){var vFld=PDP_GetById(pFldID);VAM_HookupControl(vFld,pAO,null,true);if(vFld.AO){var vOSCFnc=vFld.AO.OnSelChg;if(vOSCFnc==null)vOSCFnc="";vOSCFnc=vOSCFnc+"VAM_DoAction(gVAMActions["+pAO.id+"]);";vFld.AO.OnSelChg=vOSCFnc;}else{var vOSCFnc=PDP_GetAtt(vFld,"OnSelChg","");vOSCFnc=vOSCFnc+"VAM_DoAction(gVAMActions["+pAO.id+"]);";PDP_SetAtt(vFld,"OnSelChg",vOSCFnc);}}function PDP2VAM_UnselDateReplToken(pAO,pText){VAM_OneFldReplToken(pAO,pText);return pText.replace(new RegExp("{DATELABEL}","gm"),pAO.Cond.DateLbl);}function PDP2VAM_UDSelErrMsg(pAO){if((pAO.Cond.DateLbl=="")&&(pAO.NoLblErrMsg!=""))return pAO.NoLblErrMsg;else return pAO.ErrMsg;}function PDP2VAM_UDSelSumMsg(pAO){if((pAO.Cond.DateLbl=="")&&(pAO.NoLblSumMsg!=""))return pAO.NoLblSumMsg;else return pAO.SumMsg;}function PDP2VAM_EvalUnselDateCond(pCO){var vSpDatesID=pCO.SpecDateId;if(vSpDatesID!=""){var vDate=DTB_GetDateValue(pCO.IDToEval);if(vDate!=null){var vUTCDate=PDP_MakeUTCDate(vDate.getFullYear(),vDate.getMonth(),vDate.getDate());var vBSD=SD_FindDate(vSpDatesID,vUTCDate);if((vBSD!=null)&&!vBSD.Sel){pCO.DateLbl=vBSD.Lbl;return 0;}}return 1;}else return-1;return vResult;}function PDP2VAM_EvalUnselTimeCond(pCO){var vInc=pCO.TimeInc!=null?pCO.TimeInc:0;var vUsePicker=pCO.UseTime!=null;var vUseMin=pCO.UseMin!=null;return TMTB_IsSelectable(pCO.IDToEval,vUsePicker,vInc,vUseMin);}