// Copyright 2002 - 2007 Peter L. Blum, All Rights Reserved, www.PeterBlum.com
// Peter's Date Package Release 2.0.4

function FMP_FillInControl(pFMPId){var vMYPFld=PDP_GetById(pFMPId);var vAO=PDP_GetById(pFMPId).AO;if(!vAO.Inited)FMP_InitSize(pFMPId);FMP_SetYearRange(pFMPId,vAO);var vSelYear=PDP_GetById(pFMPId+"_Year").value;var vSelMonth=PDP_GetById(pFMPId+"_Month").value;vAO.SelCId="";var vUseMO=vAO.MOFC!=null;for(var vYear=vAO.FirstYear;vYear<vAO.LastYear;vYear++){var vYCount=vYear-vAO.FirstYear;var vH=false;if(vAO.MinY>vYear)vH=true;else if((vAO.MaxY>0)&&(vAO.MaxY<vYear))vH=true;var vRow=PDP_GetById(pFMPId+"_RYT"+vYCount);vRow.style.display=vH?"none":"";vRow.style.visibility=vH?"hidden":"inherit";var vTCell=PDP_GetById(pFMPId+"_CYT"+vYCount);PDP_SetInnerHTML(vTCell,vYear.toString());var vMaxRows=parseInt(12/vAO.NCol);var vMonth=1;for(var vRC=0;vRC<vMaxRows;vRC++){vRow=PDP_GetById(pFMPId+"_MR"+vYCount+"_"+vRC);vRow.style.display=vH?"none":"";vRow.style.visibility=vH?"hidden":"inherit";for(var vCC=0;vCC<vAO.NCol;vCC++){var vCell=PDP_GetById(pFMPId+"_M_"+(vYCount*12+(vMonth-1)));if(!vAO.Inited){vCell.onclick=new Function("FMP_ClickMonth('"+pFMPId+"','"+vCell.id+"');");if(vUseMO){vCell.onmouseover=new Function("FMP_OnMouseOver('"+vCell.id+"','"+vAO.MOFC+"','"+vAO.MOBrdC+"');");vCell.onmouseout=new Function("FMP_OnMouseOut('"+vCell.id+"');");}}var vInRange=true;if((vYear==vSelYear)&&(vMonth==vSelMonth)){vCell.className=vAO.SelMCSS;vAO.SelCId=vCell.id;}else{if(!FMP_InRange(vAO,vMonth,vYear)){vCell.className=vAO.OORCSS;vInRange=false;}else vCell.className=vAO.MCSS;}vCell.Year=vYear;vCell.Month=vMonth;vCell.InRange=vInRange;vMonth++;}}}if(vAO.SelCId!=""){var vAS=PDP_GetById(vAO.SelCId);if(vAS&&vAS.scrollIntoView)vAS.scrollIntoView(false);}vAO.Inited=true;}function FMP_SetYearRange(pFMPId,pAO){var vRule=pAO.YRR;var vMY=pAO.MxYr;var vSelYear=PDP_GetById(pFMPId+"_Year").value;var vTYear=pAO.Today.getUTCFullYear();var vFY=0;var vLY=0;while(vFY==0){switch(vRule){case 30:if(pAO.FstY>0){vFY=pAO.FstY;vLY=vFY+vMY;}else vRule=11;break;case 0:if(vSelYear>0){vFY=vSelYear;vLY=vFY+vMY;}else vRule=10;break;case 1:if(vSelYear>0){vFY=vSelYear-parseInt(vMY/2);vLY=vFY+vMY;}else vRule=11;break;case 2:if(vSelYear>0){vLY=vSelYear;vFY=vLY-vMY;}else vRule=12;break;case 20:if(pAO.MinY>0){vFY=pAO.MinY;vLY=vFY+vMY;}else vRule=10;break;case 21:if(pAO.MaxY>0){vLY=pAO.MaxY;vFY=vLY-vMY;}else vRule=12;break;case 10:vFY=vTYear;vLY=vFY+vMY;break;case 11:vFY=vTYear-parseInt(vMY/2);vLY=vFY+vMY;break;case 12:vLY=vTYear;vFY=vLY-vMY;break;}}pAO.FirstYear=vFY;pAO.LastYear=vLY;}function FMP_ClickMonth(pFMPId,pCellId){var vMYPFld=PDP_GetById(pFMPId);var vAO=vMYPFld.AO;var vCell=PDP_GetById(pCellId);if(vCell.InRange){PDP_GetById(pFMPId+"_Year").value=vCell.Year;PDP_GetById(pFMPId+"_Month").value=vCell.Month;if(vAO.SelCId!=pCellId){var vOSCFnc=vAO.OnSelChg;if(vOSCFnc)eval(vOSCFnc);}if(vAO.SelCId!="")PDP_GetById(vAO.SelCId).className=vAO.MCSS;vCell.className=vAO.SelMCSS;vAO.SelCId=pCellId;if(vAO.IsPopup)PDP_DelayedClosePopup();}}function FMP_OnMouseOver(pMCId,pFC,pBrdC){var vMC=PDP_GetById(pMCId);if(vMC.InRange){PDP_OnMouseEvent(vMC,pFC,pBrdC);}}function FMP_OnMouseOut(pMCId){FMP_OnMouseOver(pMCId,"","");}function FMP_Initialize(pFMPId,pAO,pICB){if(!gPDP_SupportsInnerHTML)return;var vMYPFld=PDP_GetById(pFMPId);if(!pAO.IsPopup)FMP_FillInControl(pFMPId);}function FMP_InitSize(pFMPId){var vMYPFld=PDP_GetById(pFMPId);var vMYPFld=PDP_GetById(pFMPId);var vOT=PDP_GetById(pFMPId+"_OuterTable");var vCM=vOT.offsetWidth;var vMCW=vMYPFld.clientWidth?vMYPFld.clientWidth:vMYPFld.width;if(vMCW>vCM)vCM=vMCW;if(!gPDP_IEWin&&vMYPFld.AO.SBar&&vMYPFld.clientWidth){vCM=vCM+30;}vMYPFld.style.width=vCM+"px";var vH=PDP_GetById(pFMPId+"_Header");if(vH)vH.style.width=vCM+"px";}function FMP_InRange(pAO,pMonth,pYear){var vR=true;if(pYear>0){if(pAO.MinM>0)vR=(pAO.MinY<pYear)||((pAO.MinY==pYear)&&(pAO.MinM<=pMonth));if(vR&&(pAO.MaxM>0))vR=(pAO.MaxY>pYear)||((pAO.MaxY==pYear)&&(pAO.MaxM>=pMonth));}return vR;}function FMP_SelectMonthYear(pFMPId,pMonth,pYear){var vMYPFld=PDP_GetById(pFMPId);var vAO=vMYPFld.AO;if((pYear>0)&&(pMonth>0)){if(!FMP_InRange(vAO,pMonth-1,pYear)){pYear=0;pMonth=0;}}PDP_GetById(pFMPId+"_Year").value=pYear;PDP_GetById(pFMPId+"_Month").value=pMonth;FMP_FillInControl(pFMPId);}function FMP_GetMonth(pFMPId){return parseInt(PDP_GetById(pFMPId+"_Month").value);}function FMP_GetYear(pFMPId){return parseInt(PDP_GetById(pFMPId+"_Year").value);}